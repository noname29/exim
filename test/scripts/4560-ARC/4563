# ARC verify, misordered headers
#
exim -DSERVER=server -bd -oX PORT_D
****
#
# This should fail signatures (manually added i=2 layer), but not crash.
# It seems that Outlook.com is _sorting_ headers before transmission;
# so it goes AS2 AS1 AMS2 AMS1 AAR2 AAR1.  We had a bug in assuming that
# the end of a list held the AMD we'd just parsed, so when the end
# hadn't had an AMS yet, we fullowed a null pointer.
#
# Mail original in aux-fixed/4560.msg1.txt
# Sig generated by: perl aux-fixed/dkim/sign_arc.pl < aux-fixed/4560.msg1.txt
client 127.0.0.1 PORT_D
??? 220
HELO xxx
??? 250
MAIL FROM:<CALLER@bloggs.com>
??? 250
RCPT TO:<a@test.ex>
??? 250
DATA
??? 354
ARC-Seal: i=2; a=rsa-sha256; cv=none; d=test.ex; s=sel; t=1521752658; b=
        xcIN0OEpAc3s8riODm31Q6JgmIECch3iVd1LXWwsypGpCY2UFFuo5HhCEf4a043q
        YZ+zn/MbFFkvwIqleeQkJ7S5UcvfM8dv/V4YnwAe+JD8r79glh/FRq6uKlc0ixLS
        CllJMwj98J1P1K9+gwmO5TrD1eTZV68caZj77P+X2kw=
ARC-Seal: i=1; a=rsa-sha256; cv=none; d=test.ex; s=sel; t=1521752658; b=
        xcIN0OEpAc3s8riODm31Q6JgmIECch3iVd1LXWwsypGpCY2UFFuo5HhCEf4a043q
        YZ+zn/MbFFkvwIqleeQkJ7S5UcvfM8dv/V4YnwAe+JD8r79glh/FRq6uKlc0ixLS
        CllJMwj98J1P1K9+gwmO5TrD1eTZV68caZj77P+X2kw=
ARC-Message-Signature: i=2; a=rsa-sha256; c=relaxed/relaxed; d=test.ex;
         h=from:to:date:message-id:subject; s=sel; bh=3UbbJTudPxmejzh7U1
        Zg33U3QT+16kfV2eOTvMeiEis=; b=WgE+YWSm48w/P448gPlBBNCKt2SJ4gosPx
        0JQ98aZJhun2RaVcUO3INc+kZv8YOijofMzFqJxVn1cgMjoU8/QSHIyyt40FzkQB
        oSGmSrCjtRnzS8pbp491NX3kGuetidaWE5muPSdOystg6mm1rBnl9sqVrwaynCmr
        fu2jTuUfw=
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=test.ex;
         h=from:to:date:message-id:subject; s=sel; bh=3UbbJTudPxmejzh7U1
        Zg33U3QT+16kfV2eOTvMeiEis=; b=WgE+YWSm48w/P448gPlBBNCKt2SJ4gosPx
        0JQ98aZJhun2RaVcUO3INc+kZv8YOijofMzFqJxVn1cgMjoU8/QSHIyyt40FzkQB
        oSGmSrCjtRnzS8pbp491NX3kGuetidaWE5muPSdOystg6mm1rBnl9sqVrwaynCmr
        fu2jTuUfw=
ARC-Authentication-Results: i=2; test.ex; arc=none
ARC-Authentication-Results: i=1; test.ex; arc=none
Authentication-Results: test.ex; arc=none
From: mrgus@text.ex
To: bakawolf@yahoo.com
Date: Thu, 19 Nov 2015 17:00:07 -0700
Message-ID: <qwerty1234@disco-zombie.net>
Subject: simple test

This is a simple test.
.
??? 250
QUIT
??? 221
****
exim -DSERVER=server -DNOTDAEMON -q
****
#
#
#
#
#
#
killdaemon
no_stdout_check
no_msglog_check
