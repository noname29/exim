# DKIM verify, ed25519
#
exim -DSERVER=server -bd -oX PORT_D
****
#
# This should pass, only Mail::DKIM::Signer does not handle ed25519-sha256 yet
#
# Mail original (will be)in aux-fixed/4500.msg1.txt
# Sig (would be) generated by: perl aux-fixed/dkim/sign.pl --algorithm=ed255190sha256 \
#			--method=simple/simple < aux-fixed/4500.msg1.txt
#
# TODO - until we have that we can only test internal consistency,
# signing vs. verification.  For now, use a message we signed with
# the Exim GnuTLS implementation (then we can test GnuTLS vs. others)
#
client 127.0.0.1 PORT_D
??? 220
HELO xxx
??? 250
MAIL FROM:<CALLER@bloggs.com>
??? 250
RCPT TO:<a@test.ex>
??? 250
DATA
??? 354
DKIM-Signature: v=1; a=ed25519-sha256; q=dns/txt; c=relaxed/relaxed; d=test.ex
	; s=sed; h=From:To:Subject; bh=/Ab0giHZitYQbDhFszoqQRUkgqueaX9zatJttIU/plc=;
	 b=5fhyD3EILDrnL4DnkD4hDaeis7+GSzL9GMHrhIDZJjuJ00WD5iI8SQ1q9rDfzFL/Kdw0VIyB4R
	Dq0a4H6HI+Bw==;
Received: from jgh by myhost.test.ex with local (Exim x.yz)
	envelope-from <jgh@myhost.test.ex>)
	 1dtXln-0000YP-Hb
	 a@test.ex; Sun, 17 Sep 2017 12:29:51 +0100
From: nobody@example.com
Message-Id: <E1dtXln-0000YP-Hb@myhost.test.ex>
Sender: CALLER_NAME <jgh@myhost.test.ex>
Date: Sun, 17 Sep 2017 12:29:51 +0100

content
.
??? 250
QUIT
??? 221
****
#
#
# Duplicate of the above, but referencing a pubkey in "wrapped-in-SubjectPublicKeyInfo"
# format.  Should pass also.
client 127.0.0.1 PORT_D
??? 220
HELO xxx
??? 250
MAIL FROM:<CALLER@bloggs.com>
??? 250
RCPT TO:<a@test.ex>
??? 250
DATA
??? 354
DKIM-Signature: v=1; a=ed25519-sha256; q=dns/txt; c=relaxed/relaxed; d=test.ex
 ; s=sedw; h=From:To:Subject; bh=/Ab0giHZitYQbDhFszoqQRUkgqueaX9zatJttIU/plc=;
 b=g0aVl5sI4fFLWDwXj9SnLgENXg2u8H8kKgK5/bXBZ7DKAImkm2+4tRzz1UOveu/Navis53Bg/C
 9nPxsspzb/Dg==;
Received: from jgh by myhost.test.ex with local (Exim x.yz)
	envelope-from <jgh@myhost.test.ex>)
	 1dtXln-0000YP-Hb
	 a@test.ex; Sun, 17 Sep 2017 12:29:51 +0100
From: nobody@example.com
Message-Id: <E1dtXln-0000YP-Hb@myhost.test.ex>
Sender: CALLER_NAME <jgh@myhost.test.ex>
Date: Sun, 17 Sep 2017 12:29:51 +0100

content
.
??? 250
QUIT
??? 221
****
#
#

# This should pass, an independently-generated sample from Scott Kitterman.
# We use a copied version of his DNS record.
client 127.0.0.1 PORT_D
??? 220
HELO xxx
??? 250
MAIL FROM:<CALLER@bloggs.com>
??? 250
RCPT TO:<a@test.ex>
??? 250
DATA
??? 354
DKIM-Signature: v=1; a=ed25519-sha256; c=relaxed/simple; d=kitterman.org;
 i=@kitterman.org; q=dns/txt; s=ed25519; t=1517847601;
 h=message-id : date : from : to : subject : date : from :
 subject; bh=wE7NXSkgnx9PGiavN4OZhJztvkqPDlemV3OGuEnLwNo=;
 b=sEnnE99Xsjpcqa/cNf8k/KQCEgjJ/4tswIKoNvq2q0fFQL6XBORJ2fQb
 Fvt34Tb4sOxlZtBYu01kEJlmGz4uCw==
Authentication-Results: lists.example.org; arc=none; spf=pass smtp.mfrom=example.com; dmarc=pass
Received: from localhost
Message-ID: <example@example.com>
Date: Mon, 01 Jan 2011 01:02:03 +0400
From: Test User <test@example.com>
To: somebody@example.com
Subject: Testing

This is a test message.
.
??? 250
QUIT
??? 221
****
#
killdaemon
#
#
#
#
# This should fail because the signing pubkey is too small.
exim -DSERVER=server -DMSIZE='rsa=1024 ed25519=300' -bd -oX PORT_D
****
#
# Duplicate test input to the first one, above.
#
client 127.0.0.1 PORT_D
??? 220
HELO xxx
??? 250
MAIL FROM:<CALLER@bloggs.com>
??? 250
RCPT TO:<a@test.ex>
??? 250
DATA
??? 354
DKIM-Signature: v=1; a=ed25519-sha256; q=dns/txt; c=relaxed/relaxed; d=test.ex
	; s=sed; h=From:To:Subject; bh=/Ab0giHZitYQbDhFszoqQRUkgqueaX9zatJttIU/plc=;
	 b=5fhyD3EILDrnL4DnkD4hDaeis7+GSzL9GMHrhIDZJjuJ00WD5iI8SQ1q9rDfzFL/Kdw0VIyB4R
	Dq0a4H6HI+Bw==;
Received: from jgh by myhost.test.ex with local (Exim x.yz)
	envelope-from <jgh@myhost.test.ex>)
	 1dtXln-0000YP-Hb
	 a@test.ex; Sun, 17 Sep 2017 12:29:51 +0100
From: nobody@example.com
Message-Id: <E1dtXln-0000YP-Hb@myhost.test.ex>
Sender: CALLER_NAME <jgh@myhost.test.ex>
Date: Sun, 17 Sep 2017 12:29:51 +0100

content
.
??? 250
QUIT
??? 221
****
killdaemon
#
no_stdout_check
no_msglog_check
